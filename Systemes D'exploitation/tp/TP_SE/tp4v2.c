#include<stdio.h>
#include<stdlib.h>
#include<unistd.h>
#include<fcntl.h>
#include<errno.h>
#include<string.h>
#include<fcntl.h>
#include<sys/stat.h>
#include<pwd.h>
#include<sys/types.h>
#include<time.h>
#include<dirent.h>
#include<getopt.h>
// fontion qui retourne un path d'un sous dir 

char *Sousdir(char *path , char *namefichier){

    int i = strlen(path);int g=i;
    path[i]='/';
    for (int y=i+1; y < g+strlen(namefichier)+1; y++)
    {
    path[y]=namefichier[y-g-1];
    }
    path[g+strlen(namefichier)+1]='\0';
          

return path;
}

void afficherdir(char *path){
    DIR *w;
    struct dirent *n;
      
    w=opendir(path);
    n=readdir(w);  
    while(n!=NULL){
                    if(strcmp(n->d_name,"..")!=0 ){printf(" %s \n",n->d_name);
}
                                      n=readdir(w); }
                                      printf("Fin de Directory\n\n");
}

void affichersousdir(char *path){
    DIR *G;
    struct dirent *R;
    struct stat files;
    char *copie;
    copie=malloc(100*sizeof(char));
    
    strcpy(copie,path);   
    G=opendir(copie);
    R=readdir(G);

    while(R!=NULL){
        stat(R->d_name,&files);
           
        if (S_ISDIR(files.st_mode) && strcmp(R->d_name,".") && strcmp(R->d_name,"..")){
        printf(" the file : %s in %s directory is a directory \n son contenu =>\n",R->d_name,Sousdir(copie,R->d_name));
    
          afficherdir(copie);
        
        }
        R=readdir(G);
        strcpy(copie,path);

    }


}




int main(int argc , char *argv[]){
struct dirent *D;
struct stat filestat;
char *t;
t=malloc(100*sizeof(char));
    DIR *p;

   getcwd(t,100);
   printf("%s \n",t);
   p=opendir(t);//home/azlees/desktop/sys.ex/tp4 +/D->d_name
   int MODE=getopt(argc,argv,"rfas");
   D=readdir(p);
 //  printf("%s:%c\n",D->d_name,D->d_type);
    switch (MODE)
    {
        case 'r':
                    while(D!=NULL){
                        stat(D->d_name,&filestat);
                    if( S_ISDIR(filestat.st_mode) && (strcmp(D->d_name,"..")!=0) ){printf(" %s \n",D->d_name);}
                                      D=readdir(p);  }
       
         break;
         case 'f':

                    while(D!=NULL){
                        stat(D->d_name,&filestat);
                    if( !(S_ISDIR(filestat.st_mode)) && (strcmp(D->d_name,"..")!=0) ){printf(" %s \n",D->d_name);}
                                      D=readdir(p);  }
         break;
         case 'a':
                    
                    while(D!=NULL){
                        stat(D->d_name,&filestat);
                    if((strcmp(D->d_name,"..")!=0) ){printf(" %s \n",D->d_name);}
                                      D=readdir(p);  }

         break;
         case 's':  //afficher les sous directory
          affichersousdir(t);

         break;
    default:
    printf("NO Paramtere entred expected a f r s\n");
        break;
    }
    

    return 0;
}
